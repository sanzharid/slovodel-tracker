<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrabble –û—á–∫–∏</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .spinner {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ */
        .player-active {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            border-color: #3B82F6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <div class="container mx-auto p-4 max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 my-4">
            –¢—Ä–µ–∫–µ—Ä –æ—á–∫–æ–≤ "–≠—Ä—É–¥–∏—Ç"
        </h1>

        <!-- 1. –≠–∫—Ä–∞–Ω –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤) -->
        <div id="setupView" class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-semibold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
            <div class="flex mb-4">
                <input type="text" id="playerNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞">
                <button id="addPlayerButton" class="bg-blue-600 text-white px-4 py-2 rounded-r-md font-semibold hover:bg-blue-700">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            
            <h3 class="text-lg font-medium mb-2">–ò–≥—Ä–æ–∫–∏:</h3>
            <ul id="playerList" class="list-disc list-inside mb-4 text-gray-700">
                <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
            </ul>

            <button id="startGameButton" class="w-full bg-green-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-green-700 transition duration-150 ease-in-out disabled:bg-gray-400">
                –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
            </button>
        </div>

        <!-- 2. –≠–∫—Ä–∞–Ω –ò–≥—Ä—ã (–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å) -->
        <div id="gameView" class="hidden">
            <!-- –¢–∞–±–ª–∏—Ü–∞ –æ—á–∫–æ–≤ -->
            <div id="scoreboard" class="flex flex-wrap gap-2 justify-center mb-4">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ–¥–æ–º -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-center mb-4">
                    –•–æ–¥ –∏–≥—Ä–æ–∫–∞: <span id="currentPlayerName" class="text-blue-600"></span>
                </h2>

                <div class="mb-4">
                    <label for="wordInput" class="block text-sm font-medium text-gray-700 mb-1">
                        –í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ:
                    </label>
                    <input type="text" id="wordInput" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –°–õ–û–í–û">
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª–æ–≤–∞ -->
                <div id="wordCheckResult" class="mt-4 mb-4 min-h-[2.5rem]"></div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button id="checkWordButton" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-700 focus:outline-none flex items-center justify-center">
                        <span id="checkButtonText">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–æ–≤–æ</span>
                        <div id="checkLoadingSpinner" class="spinner w-5 h-5 border-4 border-t-4 border-gray-200 rounded-full ml-2 hidden"></div>
                    </button>
                    
                    <button id="confirmWordButton" class="w-full bg-green-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-green-700 disabled:bg-gray-400" disabled>
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ö–æ–¥
                    </button>
                </div>
                
                <hr class="my-4">
                
                <div class="flex justify-between items-center">
                    <button id="skipTurnButton" class="text-sm text-gray-600 hover:text-gray-800">
                        –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥
                    </button>
                    <button id="endGameButton" class="bg-red-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-red-700">
                        –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
                    </button>
                </div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤ -->
            <div class="mt-6">
                <h3 class="text-xl font-semibold mb-2 text-gray-700">–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤:</h3>
                <div id="historyView" class="bg-white p-4 rounded-lg shadow-inner max-h-48 overflow-y-auto text-sm">
                    <!-- –ó–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <!-- 3. –≠–∫—Ä–∞–Ω –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è –ò–≥—Ä—ã -->
        <div id="endView" class="hidden bg-white p-6 rounded-lg shadow-lg text-center">
            <h2 class="text-3xl font-bold mb-4 text-blue-600">–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
            <h3 class="text-xl font-semibold mb-4">–ò—Ç–æ–≥–æ–≤—ã–µ –æ—á–∫–∏:</h3>
            <ol id="leaderboard" class="list-decimal list-inside text-left max-w-xs mx-auto text-lg">
                <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </ol>
            <button id="newGameButton" class="mt-6 w-full bg-blue-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-700">
                –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
            </button>
        </div>

    </div>

    <script>
        // --- –ö–û–ù–°–¢–ê–ù–¢–´ ---
        const API_KEY = 'dict.1.1.20251023T150423Z.06cb12f9a23a95e8.3b26b3711d64a1921d0adf4f92e6f16a06e3acca';
        const STORAGE_KEY = 'russianScrabbleGameState';
        
        // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ –ø–æ –±—É–∫–≤–∞–º
        const letterScores = {
            '–ê': 1, '–ë': 3, '–í': 1, '–ì': 3, '–î': 2, '–ï': 1, '–Å': 3, '–ñ': 5,
            '–ó': 5, '–ò': 1, '–ô': 4, '–ö': 2, '–õ': 2, '–ú': 2, '–ù': 1, '–û': 1,
            '–ü': 2, '–†': 1, '–°': 1, '–¢': 1, '–£': 2, '–§': 10, '–•': 5, '–¶': 5,
            '–ß': 5, '–®': 8, '–©': 10, '–™': 10, '–´': 4, '–¨': 3, '–≠': 8, '–Æ': 8, '–Ø': 3
        };
        
        // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const INITIAL_GAME_STATE = {
            players: [], // { name: '–ò–≥—Ä–æ–∫ 1', score: 0 }
            currentPlayerIndex: 0,
            gamePhase: 'setup', // 'setup', 'game', 'end'
            history: [] // { playerName: '–ò–≥—Ä–æ–∫ 1', word: '–°–õ–û–í–û', score: 8 }
        };

        // --- DOM –≠–õ–ï–ú–ï–ù–¢–´ ---
        const setupView = document.getElementById('setupView');
        const gameView = document.getElementById('gameView');
        const endView = document.getElementById('endView');

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞
        const playerNameInput = document.getElementById('playerNameInput');
        const addPlayerButton = document.getElementById('addPlayerButton');
        const playerList = document.getElementById('playerList');
        const startGameButton = document.getElementById('startGameButton');

        // –ò–≥—Ä–∞
        const scoreboard = document.getElementById('scoreboard');
        const currentPlayerName = document.getElementById('currentPlayerName');
        const wordInput = document.getElementById('wordInput');
        const wordCheckResult = document.getElementById('wordCheckResult');
        const checkWordButton = document.getElementById('checkWordButton');
        const checkButtonText = document.getElementById('checkButtonText');
        const checkLoadingSpinner = document.getElementById('checkLoadingSpinner');
        const confirmWordButton = document.getElementById('confirmWordButton');
        const skipTurnButton = document.getElementById('skipTurnButton');
        const endGameButton = document.getElementById('endGameButton');
        const historyView = document.getElementById('historyView');

        // –ö–æ–Ω–µ—Ü
        const leaderboard = document.getElementById('leaderboard');
        const newGameButton = document.getElementById('newGameButton');

        // --- –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ---
        let gameState;

        // --- –§–£–ù–ö–¶–ò–ò –°–û–°–¢–û–Ø–ù–ò–Ø (LocalStorage) ---

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState));
        }

        function loadState() {
            const savedState = localStorage.getItem(STORAGE_KEY);
            if (savedState) {
                gameState = JSON.parse(savedState);
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º structuredClone –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –∫–æ–ø–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º—É—Ç–∞—Ü–∏–∏
                gameState = structuredClone(INITIAL_GAME_STATE);
            }
        }

        // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ---

        function nextTurn() {
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            wordInput.value = '';
            wordCheckResult.innerHTML = '';
            confirmWordButton.disabled = true;
            render();
        }

        function calculateScore(word) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ, –∫—Ä–æ–º–µ —Ä—É—Å—Å–∫–∏—Ö –±—É–∫–≤, –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            const cleanWord = word.toUpperCase().replace(/[^–ê-–Ø–Å]/g, '');
            let score = 0;
            for (const letter of cleanWord) {
                score += letterScores[letter] || 0;
            }
            return score;
        }

        // --- –õ–û–ì–ò–ö–ê API (—Å CORS Proxy) ---
        
        async function checkWordApi(word) {
            setCheckLoading(true);
            wordCheckResult.innerHTML = '';
            confirmWordButton.disabled = true;

            const lang = 'ru-ru';
            const lookupWord = word.toLowerCase();
            const yandexUrl = `https://dictionary.yandex.net/api/v1/dicservice.json/lookup?key=${API_KEY}&lang=${lang}&text=${encodeURIComponent(lookupWord)}`;
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(yandexUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    // –û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ —Å–µ—Ç–∏
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ (—Å—Ç–∞—Ç—É—Å: ${response.status})`);
                }

                const proxyData = await response.json();
                if (!proxyData.contents) {
                    // –ü—Ä–æ–∫—Å–∏ –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
                    throw new Error('–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç.');
                }

                // –ü—ã—Ç–∞–µ–º—Å—è –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –Ø–Ω–¥–µ–∫—Å–∞
                const yandexData = JSON.parse(proxyData.contents);

                if (yandexData.def && yandexData.def.length > 0) {
                    // –°–ª–æ–≤–æ –Ω–∞–π–¥–µ–Ω–æ
                    const score = calculateScore(word);
                    showMessage(`–°–ª–æ–≤–æ <strong>"${word}"</strong> –Ω–∞–π–¥–µ–Ω–æ! –û—á–∫–∏: ${score}`, 'success');
                    confirmWordButton.disabled = false;
                } else {
                    // –°–ª–æ–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (API –≤–µ—Ä–Ω—É–ª 200 OK, –Ω–æ –ø—É—Å—Ç–æ–π 'def')
                    showMessage(`–°–ª–æ–≤–æ <strong>"${word}"</strong> –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —Å–ª–æ–≤–∞—Ä–µ.`, 'error');
                }
            } catch (error) {
                // *** –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ ***
                // –≠—Ç–∞ –æ—à–∏–±–∫–∞ –ª–æ–≤–∏—Ç—Å—è, –µ—Å–ª–∏:
                // 1. fetch() –ø–∞–¥–∞–µ—Ç (–Ω–µ—Ç —Å–µ—Ç–∏)
                // 2. response.ok == false (–æ—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏)
                // 3. JSON.parse(proxyData.contents) –ø–∞–¥–∞–µ—Ç (Yandex –≤–µ—Ä–Ω—É–ª HTML-–æ—à–∏–±–∫—É 404, –∞ –Ω–µ JSON)
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–ª–æ–≤–∞:', error);
                showMessage(`–°–ª–æ–≤–æ <strong>"${word}"</strong> –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ API).`, 'error');
            } finally {
                setCheckLoading(false);
            }
        }

        // --- –§–£–ù–ö–¶–ò–ò –†–ï–ù–î–ï–†–ò–ù–ì–ê (–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ UI) ---

        function render() {
            // 0. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            saveState();

            // 1. –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ "—ç–∫—Ä–∞–Ω—ã"
            setupView.classList.add('hidden');
            gameView.classList.add('hidden');
            endView.classList.add('hidden');

            // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–∞–∑—ã –∏–≥—Ä—ã
            if (gameState.gamePhase === 'setup') {
                setupView.classList.remove('hidden');
                renderSetup();
            } else if (gameState.gamePhase === 'game') {
                gameView.classList.remove('hidden');
                renderGame();
            } else if (gameState.gamePhase === 'end') {
                endView.classList.remove('hidden');
                renderEnd();
            }
        }
        
        function renderSetup() {
            playerList.innerHTML = '';
            if (gameState.players.length === 0) {
                playerList.innerHTML = '<li class="text-gray-500">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤...</li>';
            } else {
                gameState.players.forEach((player, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${index + 1}. ${player.name}`;
                    playerList.appendChild(li);
                });
            }
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –∞–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 2 –∏–≥—Ä–æ–∫–∞
            startGameButton.disabled = gameState.players.length < 2;
        }

        function renderGame() {
            // –†–µ–Ω–¥–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –æ—á–∫–æ–≤
            scoreboard.innerHTML = '';
            gameState.players.forEach((player, index) => {
                const isActive = index === gameState.currentPlayerIndex;
                const card = document.createElement('div');
                card.className = `p-3 rounded-lg border-2 shadow-md bg-white transition-all duration-300 ${isActive ? 'player-active' : 'border-gray-200'}`;
                card.innerHTML = `
                    <div class="font-semibold text-gray-800">${player.name}</div>
                    <div class="text-2xl font-bold ${isActive ? 'text-blue-600' : 'text-gray-600'}">${player.score}</div>
                `;
                scoreboard.appendChild(card);
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            if (gameState.players.length > 0) {
                currentPlayerName.textContent = gameState.players[gameState.currentPlayerIndex].name;
            }
            
            // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
            historyView.innerHTML = '';
            if (gameState.history.length === 0) {
                historyView.innerHTML = '<p class="text-gray-500">–ü–æ–∫–∞ –Ω–µ—Ç —Ö–æ–¥–æ–≤...</p>';
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–æ–¥—ã –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–≤–µ—Ä—Ö—É)
                [...gameState.history].reverse().forEach(move => {
                    const p = document.createElement('p');
                    p.className = 'border-b border-gray-200 pb-1 mb-1';
                    p.innerHTML = `<strong>${move.playerName}</strong>: ${move.word} (+${move.score} ${getPointsString(move.score)})`;
                    historyView.appendChild(p);
                });
                // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
                historyView.scrollTop = historyView.scrollHeight;
            }
        }
        
        function getPointsString(score) {
            const lastDigit = score % 10;
            const lastTwoDigits = score % 100;
            if (lastTwoDigits >= 11 && lastTwoDigits <= 19) return '–æ—á–∫–æ–≤';
            if (lastDigit === 1) return '–æ—á–∫–æ';
            if (lastDigit >= 2 && lastDigit <= 4) return '–æ—á–∫–∞';
            return '–æ—á–∫–æ–≤';
        }

        function renderEnd() {
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –æ—á–∫–∞–º (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
            
            leaderboard.innerHTML = '';
            sortedPlayers.forEach((player, index) => {
                const li = document.createElement('li');
                li.className = 'mb-2 p-2 rounded';
                let content = `<strong>${player.name}</strong>: ${player.score} ${getPointsString(player.score)}`;
                if (index === 0) {
                    content = `ü•á ${content}`;
                    li.className += ' bg-yellow-100 text-yellow-800';
                } else if (index === 1) {
                    content = `ü•à ${content}`;
                    li.className += ' bg-gray-200';
                } else if (index === 2) {
                    content = `ü•â ${content}`;
                    li.className += ' bg-orange-100 text-orange-800';
                }
                li.innerHTML = content;
                leaderboard.appendChild(li);
            });
        }
        
        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UI ---

        function setCheckLoading(isLoading) {
            if (isLoading) {
                checkButtonText.classList.add('hidden');
                checkLoadingSpinner.classList.remove('hidden');
                checkWordButton.disabled = true;
            } else {
                checkButtonText.classList.remove('hidden');
                checkLoadingSpinner.classList.add('hidden');
                checkWordButton.disabled = false;
            }
        }

        function showMessage(message, type = 'error') {
            const colorClass = type === 'success' ? 'text-green-600' : 'text-red-600';
            wordCheckResult.innerHTML = `<p class="font-medium ${colorClass}">${message}</p>`;
        }

        // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---

        function handleAddPlayer() {
            const name = playerNameInput.value.trim();
            if (name) {
                gameState.players.push({ name: name, score: 0 });
                playerNameInput.value = '';
                render();
            }
        }

        function handleStartGame() {
            if (gameState.players.length >= 2) {
                gameState.gamePhase = 'game';
                gameState.currentPlayerIndex = 0;
                render();
            }
        }
        
        function handleCheckWord() {
            const word = wordInput.value.trim();
            if (word) {
                checkWordApi(word);
            } else {
                showMessage('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.', 'error');
            }
        }
        
        function handleConfirmWord() {
            const word = wordInput.value.trim();
            if (word) {
                const score = calculateScore(word);
                const player = gameState.players[gameState.currentPlayerIndex];
                
                player.score += score;
                gameState.history.push({
                    playerName: player.name,
                    word: word,
                    score: score
                });
                
                nextTurn(); // –≠—Ç–æ —Ç–∞–∫–∂–µ –≤—ã–∑–æ–≤–µ—Ç render()
            }
        }
        
        function handleSkipTurn() {
            gameState.history.push({
                playerName: gameState.players[gameState.currentPlayerIndex].name,
                word: '–ø—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞',
                score: 0
            });
            nextTurn();
        }
        
        function handleEndGame() {
            // –í –∑–∞–¥–∞–Ω–∏–∏ —Å–∫–∞–∑–∞–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å confirm(), –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–µ—Ä—à–∞–µ–º.
            gameState.gamePhase = 'end';
            render();
        }
        
        function handleNewGame() {
            // *** –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ ***
            localStorage.removeItem(STORAGE_KEY);
            gameState = structuredClone(INITIAL_GAME_STATE);
            
            // –°–±—Ä–æ—Å –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –≤—Ä—É—á–Ω—É—é
            playerNameInput.value = '';
            wordInput.value = '';
            wordCheckResult.innerHTML = '';
            
            render(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º UI, —á—Ç–æ –≤–µ—Ä–Ω–µ—Ç –Ω–∞—Å –Ω–∞ 'setupView'
        }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        addPlayerButton.addEventListener('click', handleAddPlayer);
        playerNameInput.addEventListener('keyup', (e) => e.key === 'Enter' && handleAddPlayer());
        
        startGameButton.addEventListener('click', handleStartGame);
        
        checkWordButton.addEventListener('click', handleCheckWord);
        confirmWordButton.addEventListener('click', handleConfirmWord);
        wordInput.addEventListener('keyup', (e) => e.key === 'Enter' && handleCheckWord());
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å–ª–æ–≤–æ
        wordInput.addEventListener('input', () => {
             confirmWordButton.disabled = true;
             wordCheckResult.innerHTML = '';
        });

        skipTurnButton.addEventListener('click', handleSkipTurn);
        endGameButton.addEventListener('click', handleEndGame);
        
        newGameButton.addEventListener('click', handleNewGame);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
        loadState();
        render();

    </script>
</body>
</html>

